<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>@import url(http://fonts.googleapis.com/earlyaccess/jejugothic.css);</style>
<style>@import url(https://fonts.googleapis.com/css?family=Dosis:400,800);</style>
<title>꽃보다 아름다운</title>  
<link rel="stylesheet" href="../css/flexslider.css" type="text/css">
<style>@import url(http://fonts.googleapis.com/earlyaccess/jejugothic.css);</style>  
<link rel="stylesheet" type="text/css" href="../css/bootstrap_yeti.css">
<style>
a, h3, td { font-family: 'Jeju Gothic', serif; }
.body-content{
	width: 80%;
	margin-left: 150px;
	margin-right: 150px;
}
.left { 
	width: 49%;  
	margin-top: 10px; 
	position: relative;
	float: left;
}
.right { 
	width: 49%;  
	margin-top: 10px; 
	position: relative;
	float: right;
}
#title{
	margin-left: 150px;
} 
</style>
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script> -->
<script type="text/javascript" src="../lib/jquery/jquery.js"></script>
<script type="text/javascript" src="../js/jquery.flexslider.js"></script>
<script type="text/javascript" src="../js/common.js"></script>
<script>
$(window).load(function() {
	/*
  $('.flexslider').flexslider({
    animation: "slide"
    //controlNav: "thumbnails"
  });
	*/
});

$(document).ready(function() {
	$('#top').load('top.html').trigger('pagecreate');
	$.getJSON(contextRoot + '/cosmetic/ajax/loginCheck.do', function(resultObj) {
		var ajaxResult = resultObj.ajaxResult;
		var member = ajaxResult.data;
		if(member != null){
			console.log(member.id);
			$('.changeValue1').html('LOGOUT').attr('onclick','return logout();');
			$('.changeValue2').html('Hello '+member.id).removeAttr('onclick');
		}
	}).error(function(error) {
		window.location.href='login.html';
	});
	
	 // 파라미터 번호 추출
 	 var reviewNo = location.href.split('?')[1].split('=')[1];
 	 
 	 $.getJSON(contextRoot + '/cosmetic/ajax/reviewListDetail.do?reviewNo='+reviewNo,function(resultObj){
 		 var ajaxResult = resultObj.ajaxResult;
 		 var reviewDetail = ajaxResult.data;
 		// 로그인 헤더 처리
		if(reviewDetail.member != null){
			$('.changeValue1').html('LOGOUT').attr('onclick','return logout();');
			$('.changeValue2').html('Hello '+ reviewDetail.member.id).removeAttr('onclick');
			$('#commentId').text(reviewDetail.member.id);
		}
 		
 		if(ajaxResult.status == 'success'){
 			 
 	 		 $('#data-title').text(reviewDetail.review.title);
 			 $('#data-content').text(reviewDetail.review.content);
 	 		 $('#viewCnt').text(reviewDetail.review.viewCnt);
 			 
 	 		
 	 		 
 	 		 for(var photoList of reviewDetail.photo){
 	 			 var li =   '<li data-thumb="'+photoList.filePath+'">	 ';
		             li +=  '<img src="'+photoList.filePath+'" style="width:100%"/>     ';
		             li +=  '</li>                                     ';
		         $('.slides').append(li);   
 	 		 }
 	 		 
     	 		$('.flexslider').flexslider({
     	 		    animation: "slide"
     	 		    //controlNav: "thumbnails"
     	 		});
     	 	
     	 	 // 빈 오브젝트 체크
     	 	 var emptyCheck =  $.isEmptyObject(reviewDetail.comment);
     	 	 
 	 		 for(var commentList of reviewDetail.comment){
 	 				
 	 			 // 날짜 변환
		 		var formattedDate = new Date(commentList.regDate);
				var years = formattedDate.getFullYear();
				var months = formattedDate.getMonth() + 1;
				var days = formattedDate.getDate();
				var hours = formattedDate.getHours();
				var minutes = formattedDate.getMinutes();
				var regDate = years + '.' + months +'.'+ days + ' ' + hours + ':' + minutes;
				
 	 			 var tr = '<tr id=c_'+commentList.commentNo+'>';
	                 tr+=     '	<td>'+coomentList.commentNo+'</td>                                                                                            															';
	                 tr+=     '	<td>'+commentList.member[0].id+'</td>                                                                                         															';
	                 tr+=     '	<td>'+commentList.content+'</td>                                                                                              															';
	                 tr+=     '	<td>'+regDate+'</td>                                                                                                          															';
	                 tr+=     '<td class="favorite"><a href="#" class="btn btn-danger btn-xs">수정</a><a href="#" onclick=commentDel('+commentList.commentNo+','+reviewNo+') class="btn btn-danger btn-xs">삭제</a></td>';
	                 tr+= '</tr>		                                                                                                                    															';
 	 		 	 $('#comment-area').append(tr);
 	 		 }
 	 		 
 	 		 if(emptyCheck){
 	 			var tr = '<tr>';
                tr+=     '	<td colspan=5 align="center">작성된 댓글이 없습니다.</td>                                                                                                                      ';
                tr+=     '</tr>		                                                                                                                    ';
 		 	 	$('#comment-area').append(tr);
 	 		 }
 	 		 
 		 }
 		 
 	 }).error(function(error) {
		 window.location.href='login.html';
	 });
 	 
 	 function commentDel(commentNo, reviewNo) {
		$.ajax({
			url: contextRoot + '/cosmetic/ajax/reviewCommentDelete.do',
			data : {
				commentNo : commentNo,
				reviewNo : reviewNo
			}
		}).done(function(resultObj) {
			
		});
	 }
 	 
 	 $('#deleteBtn').click(function() {
		  $.get(contextRoot+'/cosmetic/ajax/reviewDelete.do?reviewNo='+reviewNo,function(resultObj){
			   var ajaxResult = resultObj.ajaxResult;
			   console.log(ajaxResult.status);
			   var status = ajaxResult.status;
			   
			   if(status == 'success'){
				   alert('게시글이 삭제되었습니다.');
				   location.href = 'user_review_list.html';
			   }
			   else{
				   alert('권한이 없습니다.');
			   }
			   
		  },'json');
	 });
 	 
 	 $('#updateBtn').click(function() {
 		 //권한 체크
 	  $.get(contextRoot+'/cosmetic/ajax/authority.do?reviewNo='+reviewNo,function(resultObj){
 			 var ajaxResult = resultObj.ajaxResult;
 			 var status = ajaxResult.status;
 			 
 			 if(status == 'success'){
 				location.href = 'reviewUpdate.html?reviewNo='+reviewNo; 
 			 }
 			 else{
 				 alert('권한이 없습니다.')
 			 }
 			 
 		 },'json');
		 
	 });
 	 
 	 $('#submitBtn').click(function() {
		$.post(contextRoot+'/cosmetic/ajax/reviewCommentAdd.do',{
			reviewNo : reviewNo,
			content : $('#textArea').val()
		},function(resultObj){
			var ajaxResult = resultObj.ajaxResult;
			var status = ajaxResult.status;
			var data = ajaxResult.data;
			var comment = data.comment;
			console.log(comment);
			
			if(status == 'success'){
				
			}
			
		},'json');
	 });
 	 
});
</script>
</head>

<body>
	<!-- top -->
	<div data-role="page" id="top"></div>
<<<<<<< HEAD
	<!-- 유저리뷰 표시줄 -->
    <p class="lead" style="margin-top: 30px; margin-left: 160px; color: #cf2d39; font-size: 20pt;">User Review</p>
    <div style="width: 1065px; margin-left: 160px; margin-top: 0px;"><hr /></div>
    
=======
    <div id="title"><h1 id="data-title"></h1></div>
>>>>>>> 20177c8f920af017a2f7c84d5535b73eafa15511
    <div class="body-content"> 
    	<!-- 본문_좌 --> 
        <div class="left">
        	<div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title">PHOTO</h3>
              </div>
              <div class="panel-body">
              	<div class="flexslider">
                  <ul class="slides">
<!--                     <li data-thumb="../images/성형전.PNG"> -->
<!--                       <img src="../images/성형전.PNG" /> -->
<!--                     </li> -->
<!--                     <li data-thumb="../images/after2.jpg"> -->
<!--                       <img src="../images/after2.jpg" /> -->
<!--                     </li> -->
<!--                     <li data-thumb="../images/after3.jpg"> -->
<!--                       <img src="../images/after3.jpg" /> -->
<!--                     </li> -->
<!--                     <li data-thumb="../images/일반인후기3.jpg"> -->
<!--                       <img src="../images/일반인후기3.jpg" /> -->
<!--                     </li> -->
                  </ul>
                </div>	 
            </div>	 
        </div> 
        </div>
        
      <!-- 본문_우 -->
      <div class="right"> 
          <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title">CONTENT</h3>
              </div>
              <div id="data-content" class="panel-body">
              </div>
        	</div> 
            <div style="float: right; line-height: 0;">좋아요 330 | <a href="">댓글 2343</a> | 조회 <span id="viewCnt">34231</span></div><br/><br/>
            
            <!-- 댓글 -->
            <div class="panel panel-default">
  				<div class="panel-heading">
                	<h3 class="panel-title">COMMENT</h3>
                </div>
                  <div class="panel-body">
                    <table class="table table-striped table-hover">
                  <thead>
                    <tr>
                      <th>No.</th>
                      <th>글쓴이</th>
                      <th>내용</th>
                      <th>등록일</th>
                      <th>수정 | 삭제</th>
                    </tr>
                  </thead>
                  <tbody id="comment-area"> 
<!--                     <tr> -->
<!--                       <td>1</td> -->
<!--                       <td>김초롱</td> -->
<!--                       <td>와전다 진시 다른 사람</td> -->
<!--                       <td>2016-02-19 14:95</td> -->
<!--                       <td class="favorite"><a href="#" class="btn btn-danger btn-xs">좋아요</a><a href="#" class="btn btn-danger btn-xs">신고</a></td> -->
<!--                     </tr>  -->
                  </tbody> 
                </table>	 
                  </div>
<!--                   <div style="padding: 0px; margin: 0px; line-height: none; text-align: center;"> -->
<!--                   	<ul class="pagination pagination-sm"> -->
<!--                       <li class="disabled"><a href="#">&laquo;</a></li> -->
<!--                       <li class="active"><a href="#">1</a></li> -->
<!--                       <li><a href="#">2</a></li> -->
<!--                       <li><a href="#">3</a></li> -->
<!--                       <li><a href="#">4</a></li> -->
<!--                       <li><a href="#">5</a></li> -->
<!--                       <li><a href="#">&raquo;</a></li> -->
<!--                     </ul> -->
<!--                   </div> -->
                <div class="row">
						<div class="col-xs-12 col-sm-6 col-md-8" style="margin-left: 20px; width: 90%">
								<form class="form-horizontal">
								  <fieldset>
								    <legend>Comment Regist</legend>
								    <div class="form-group">
								      <label id="commentId" for="textArea" class="col-lg-2 control-label"></label>
								      <div class="col-lg-10">
								        <textarea class="form-control" rows="3" id="textArea"></textarea>
								      </div>
								    </div>
								    
								    <div class="form-group">
								      <div class=".col-md-3 .col-md-offset-3" style="float: right; margin-right: 13px;">
								        <button type="button" id="submitBtn" class="btn btn-info">Submit</button>
								      </div>
								    </div>
								    
								  </fieldset>
								</form>
						</div>
				</div>
              </div>
              
            <div style="float: left;">
            	<button type="button" class="btn btn-default" aria-label="Left Align">
				  <span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span> 좋아요
				</button>
            	<button type="button" class="btn btn-default" aria-label="Left Align">
				  <span class="glyphicon glyphicon-heart" aria-hidden="true"></span> 찜
				</button>
            </div>
            
            <div style="float: right;">
            	<a href="#" id="updateBtn" class="btn btn-warning">UPDATE</a>
	      		<a href="#" id="deleteBtn" class="btn btn-danger">DELETE</a>
	      		<a href="user_review_list.html" class="btn btn-primary">LIST</a>
            </div>
            </div>
      </div>
      
      <script>
      </script>  
</body>
</html>





















